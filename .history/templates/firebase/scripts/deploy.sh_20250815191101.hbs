#!/bin/bash

# Script de déploiement principal pour {{project.name}}
# Usage: ./scripts/deploy.sh [environment]

set -e

ENVIRONMENT=${1:-dev}
PROJECT_NAME="{{project.name}}"

echo "🚀 Déploiement de $PROJECT_NAME en $ENVIRONMENT..."

# Vérifier l'environnement
if [[ ! "$ENVIRONMENT" =~ ^(dev|staging|prod)$ ]]; then
    echo "❌ Environnement invalide. Utilisez: dev, staging, ou prod"
    exit 1
fi

# Vérifier que Firebase CLI est installé
if ! command -v firebase &> /dev/null; then
    echo "❌ Firebase CLI non installé. Installez-le avec: npm install -g firebase-tools"
    exit 1
fi

# Vérifier que l'utilisateur est connecté
if ! firebase projects:list &> /dev/null; then
    echo "❌ Utilisateur Firebase non connecté. Connectez-vous avec: firebase login"
    exit 1
fi

echo "✅ Vérifications terminées"

# Build frontend
echo "📦 Build du frontend..."
cd frontend
npm install
npm run build
cd ..

# Build backend
echo "🔥 Build du backend..."
cd backend/functions
npm install
npm run build
cd ../..

# Déploiement Firebase
echo "🚀 Déploiement Firebase..."
firebase use $ENVIRONMENT
firebase deploy

echo "✅ Déploiement terminé avec succès!"
echo "🌐 URL: https://{{project.name}}-$ENVIRONMENT.web.app" 