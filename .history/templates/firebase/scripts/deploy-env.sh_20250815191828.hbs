#!/bin/bash

# Script de dÃ©ploiement pour l'environnement {{environment.name}}
# Usage: ./scripts/deploy-{{environment.name}}.sh

set -e

ENVIRONMENT="{{environment.name}}"
PROJECT_ID="{{environment.projectId}}"
REGION="{{environment.region}}"
PROJECT_NAME="{{project.name}}"

echo "ğŸš€ DÃ©ploiement de $PROJECT_NAME en $ENVIRONMENT..."
echo "ğŸ“ Projet: $PROJECT_ID"
echo "ğŸŒ RÃ©gion: $REGION"

# VÃ©rifier que Firebase CLI est installÃ©
if ! command -v firebase &> /dev/null; then
    echo "âŒ Firebase CLI non installÃ©. Installez-le avec: npm install -g firebase-tools"
    exit 1
fi

# VÃ©rifier que l'utilisateur est connectÃ©
if ! firebase projects:list &> /dev/null; then
    echo "âŒ Utilisateur Firebase non connectÃ©. Connectez-vous avec: firebase login"
    exit 1
fi

# VÃ©rifier que le projet existe
if ! firebase projects:list | grep -q "$PROJECT_ID"; then
    echo "âŒ Projet $PROJECT_ID non trouvÃ© dans votre compte Firebase"
    exit 1
fi

echo "âœ… VÃ©rifications terminÃ©es"

# Basculer vers le projet
echo "ğŸ”„ Basculement vers le projet $PROJECT_ID..."
firebase use $PROJECT_ID

# Build frontend
echo "ğŸ“¦ Build du frontend..."
cd frontend
npm install
npm run build
cd ..

# Build backend
echo "ğŸ”¥ Build du backend..."
cd backend/functions
npm install
npm run build
cd ../..

# DÃ©ploiement Firebase
echo "ğŸš€ DÃ©ploiement Firebase..."
firebase deploy --only hosting,functions,firestore:rules,storage

echo "âœ… DÃ©ploiement en $ENVIRONMENT terminÃ© avec succÃ¨s!"
echo "ğŸŒ URL: https://$PROJECT_ID.web.app" 